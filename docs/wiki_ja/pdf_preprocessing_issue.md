# PDF画像前処理機能の拡張案

現在 `tools/pdf_to_images.py` はPDFをページごとにPNG画像へ変換するのみの実装となっています。OCR精度向上のためには画像を前処理してから解析することが望まれますが、既存の挙動を変えてしまうと混乱を招く可能性があります。

## 要件

- 既存の画像変換の動作はそのまま保持する。
- 必要に応じて前処理を実行できるよう、CLIオプションで指定可能とする。
- 前処理を行った画像は、元画像と同名で `preprocessed_images/` サブディレクトリに保存する。
- どの前処理を適用したか分かるよう、同ディレクトリにログファイルを残す。
- 前処理手法は今後追加される可能性が高いため、拡張しやすい構成とする。

## 実装方針

1. `pdf_to_images.py` に `--preprocess` オプションを追加し、`grayscale` や `binarize` などの処理名をカンマ区切りで指定できるようにする。
2. 前処理用の関数群は `tools/image_preprocess.py` にまとめ、`PREPROCESS_FUNCTIONS` 辞書で管理する。画像(`PIL.Image`)を受け取って処理後の画像を返す関数として実装し、新しい処理を追加する際はこの辞書に関数を登録するだけで済む。
3. 元画像は従来どおり `output_images/` に保存し、前処理を指定した場合のみ `output_images/preprocessed_images/` に処理後の画像を保存する。
4. どの画像にどの処理を行ったかを `preprocessed_images/preprocess.log` に記録する。ログには処理名と保存先ファイル名を簡潔に記載する。

## 期待される効果

- OCR前の画像品質を向上させることで解析精度の改善が期待できる。
- 前処理の有無や内容を明示的に管理できるため、既存フローへの影響を最小限に抑えられる。
- 関数の追加のみで新しい前処理を導入でき、保守性・拡張性が高い実装となる。

